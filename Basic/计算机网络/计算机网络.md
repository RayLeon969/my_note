# 第一章	概述



## 一.互联网概述

1. 网络的网络：计算机网络由若干**结点**和连接这些结点的**链路**组成，网络和网络之间由路由器连接起来，就叫互联网



## 二.互联网的组成

  互联网从其工作方式上看可以分为：**边缘部分**和**核心部分**

- **边缘部分**：由所有连接在互联网上的主机组成。这部分式用户直接使用的，用来进行通信和资源共享
  - 在网络边缘的端系统之间的通信方式可以划分成两大类：C/S方式和P2P方式

- **核心部分**：由大量网络和连接这些网络的路由器组成。这部分是为边缘部分提供服务的

​       在网络核心部分起特殊作用的是路由器，路由器是实现分组交换的关键构件，其任务是转发收到的分组

- 电路交换的主要特点：速度快，独占资源（需要事先建立连接）缺点是线路的传输效率很低
- 分组交换的主要特点：共享资源，不用事先建立连接，分组交换采用存储转发技术，把一个报文划分为几个分组后再进行传送

-  按照网络的作用范围进行分类：
  - 广域网WAN
  - 城域网MAN
  - 局域网LAN
  - 个人区域网PAN



## 三.计算机网络的性能

- 计算机网络的性能指标
  - 速率：速率是指数据的传送速率，也称数据率或比特率，单位是bit/s
  - 带宽：是指某网络中某通道传送数据的能力
  - 吞吐量：表示在某个单位时间内通过某个网络的实际数据量
  - 时延：是指数据从网络的一端到另一端所需的时间
    - 发送时延：是主机或路由器发送数据帧所需要的时间
      - 公式：数据帧长度/发送速率
    - 传播时延：是电磁波在信道中传播一定的距离需要花费的时间
      - 公式：信道长度/电磁波在信道上的传播速率
    - 处理时延
    - 排队时延
  - 时延带宽积：传播实验×带宽
  - 往返时间RTT：重要性能指标
    - 发送时间=数据长度/发送速率
    - 有效数据率=数据长度/（发送时间+RTT）
  - 利用率
    - 网络当前时延=网络空闲时延/（1-利用率）



## 四.计算机网络的体系结构

- OSI七层协议体系结构(从上往下)
  - 应用层
  - 表示层
  - 会话层
  - 运输层
  - 网络层
  - 数据链路层
  - 物理层
- TCP/IP的四层协议
  - 应用层
  - 运输层
  - 网际层
  - 网络接口层
- 五层协议
  - 应用层
  - 运输层
  - 网络层
  - 数据链路层
  - 物理层

  协议三要素

- 语法
- 语义
- 同步



# 第二章	物理层



## 一 物理层的基本概念

  **物理层考虑的是怎么样才能在连接各种计算机的传输媒体上传输数据比特流，而不是只具体的传输媒体。**

  ==**物理层的真正作用是尽可能地屏蔽掉这些传输媒体和通信手段的差异**==

- 将物理层的主要任务描述为确定与传输媒体的接口有关的一些特性
  - 机械特性
  - 电气特性
  - 功能特性
  - 过程特性



## 二 数据通信的基础知识

   一个数据通信系统可以划分为三大部分

- 源系统（发送端，发送方）
- 传输系统（传输网络）
- 目的系统（接收端，接收方）

  信号可以分为以下两大类

- 模拟信号（连续信号）
- 数字信号（离散信号）

  从信道的双方信息交互的方式来看，可以有以下三种基本方式

- 单向通信（单工通信）A->B
- 双向交替通信（半双工通信）A->B B->A
- 双向同时通信（全双工通信）A<->B<->C

  曼彻斯特编码：位周期中心的向上跳变代表0，位周期中心的向下跳变代表1。也可以反过来定义

  基本的带通调制方法

- 调幅(AM)
- 调频(FM)
- 调相(PM)



## 三 物理层下面的传输媒体

- 双绞线
  - 优点：价格便宜，性能较好
- 同轴电缆
  - 优点：价格昂贵，性能一般
- 光缆
  - 优点：价格昂贵，性能极好



## 四 信道复用技术

- 频分复用
- 时分复用
- 统计时分复用
- 统计多路复用->分组交换使用最多

宽带的概念：接入速率超过56Kb/s就是宽带



# 第三章	数据链路层

数据链路层使用的信道主要有以下两种类型：

- 点对点信道
- 广播信道

**路由器在转发分组时使用的协议栈只有下面三层：==网络层，数据链路层，物理层。==**

![image-20231115165812045](assets\image-20231115165812045.png)



## 一 使用点对点信道的数据链路层

  数据链路层的协议数据单元--帧

  三个基本问题：



### 封装成帧

封装成帧就是在一段数据的前后分别添加首部和尾部，这样就构成了一个帧

![image-20231115165936913](assets\image-20231115165936913.png)

![image-20231115165955546](assets\image-20231115165955546.png)



### 透明传输

用字节填充的方法解决透明传输问题

![image-20231115170210086](assets\image-20231115170210086.png)



### 差错检测

目前在数据链路层广泛使用**循环冗余检验CRC**的检错技术。（注意：只能检错不能纠错）

​       通过运算得出冗余码，然后将冗余码放在数据后面。

​       收发双方事先商定长度为（n+1）的除数P，被除数所需添加的零的数量就是n，最后计算出来的冗余码为001，添加到原始数据101001后面

​       就构成了新的发送的数据：101001001，接收方收到这串数据后与约定好的除数P在进行一次CRC校验，得到的余数R为0的话就代表这个帧是没有差错的，反之亦然。

![image-20231115170252242](assets\image-20231115170252242.png)

OSI的观点是：必须让数据链路层向上**提供可靠传输，因此在CRC的基础上，增加了编号，确认，重传机制。**



## 二 使用广播信道的数据链路层

 以太网的标准：

- 10 Base-T
  - 10：传输速率为10Mbit/s
  - Base：基带信号
  - T：非屏蔽双绞线

  CSMA/CD协议

  以太网提供的服务是尽最大努力交付，即不可靠交付。

  以太网发送的数据都是用曼彻斯特编码

  CSMACD协议的要点

- 多点接入：说明这是总线型网络，许多计算机以多点接入的方式连接在一根总线上。
- 载波监听：利用电子技术检测总线上有没有其他计算机也在发送。实质上就是检测信道，不管在发送前还是发送中，每个站都必须不停地检测信道。
- 碰撞检测：边发送边监听。

  **通过CSMA/CD协议我们可以知道最迟要经过多长时间才能知道自己发送的数据和其他站发送的数据有没有发生碰撞，得出结论是这个时间最多是两倍的总线端到端的传播时延以及以太网的最小帧长度：64字节**

  显然，在使用CSMA/CD协议时，一个站不可能同时进行发送和接收（但必须边发送边监听信道）。因此，使用CSMA/CD协议的以太网只能半双工通信。

  **以太网的最小帧长度：64字节**

  10BASE-T以太网的通信距离稍短，每个站到集线器的距离不得超过100m

  **网络结构：逻辑上来说是总线型，物理上来说是星型。**

  **集线器工作在物理层，交换机工作在数据链路层**



**以太网的MAC（介质访问控制）层**

  在局域网中，硬件地址又称为物理地址或MAC地址。

  **MAC地址长度：48位**

  MAC帧格式；

![image-20231115170615248](assets\image-20231115170615248.png)

以太网净荷：46~1500

有效MAC帧长度：64~1518

在IP数据报上添加18字节的信息段构成MAC帧



## 三 交换机  

**交换机工作在数据链路层**

以太网交换机实质上就是一个多接口的网桥,交换机的出现使得以太网的数据传输没有了碰撞出现，也使得以太网能以全双工通信的方式工作（因为每台主机之间都有一条道路连接）

==交换机的自学习功能==：A向B传输数据，首先交换机查自身携带的交换表，若没有B对应的MAC地址和接口，此时如果也没有A的MAC地址和接口就先记录A的MAC地址和接口到交换表，然后广播收取信息，过滤到用不到的信息后收到B的MAC地址和端口，然后将A的数据传递给B，记录B的MAC地址和接口到自己的交换表中,下次A向B或者B向A传输数据的时候就不需要进行广播了。

虚拟局域网（VLAN）

VLAN是由一些局域网网段构成的与物理位置无关的逻辑组

个人理解：相当于共享多个局域网中交换机中的交换表

VLAN的作用：有效隔离广播域



# 第四章	网络层



## 一 网络层提供的两种服务

  互联网的设计思路：网络层向上只提供简单灵活的，无连接的，**尽最大努力交付的数据报服务.**

- 虚电路服务（类似电路交换，事先建立连接）
- 数据报服务（类似分组交换，不需要事先建立连接）



## 二 网际协议IP

  网际协议IP是TCP/IP体系中两个最主要的协议之一，也是最重要的互联网标准协议之一。

  与IP协议配套使用的还有三个协议：

- 地址解析协议ARP
- 网际控制报文协议ICMP
- 网际组管理协议IGMP

  互联网可以由多种异构网络互联而成

  分类的IP地址

  整个的互联网就是一个单一的，抽象的网络。

  IP地址就是给互联网上的每一台主机（或路由器）的每一个接口分配一个在**全世界范围内是唯一的32位的标识符**

  **IP地址={<网络号>,<主机号>}**

![image-20231115170950206](assets\image-20231115170950206.png)

A类网络：

- 第一个可指派的网络号：1
- 最后一个可指派的网络号：126
- 最大主机数：16777214

  B类网络：

- 第一个可指派的网络号：128.1
- 最后一个可指派的网络号：191.255
- 最大主机数：65534

  C类网络：

- 第一个可指派的网络号：192.0.1
- 最后一个可指派的网络号：223.255.255
- 最大主机数：254

  ==地址解析协议ARP（IP->MAC）==

  我们知道，网络层使用的是IP地址，但在实际网络的链路上传送数据帧时，最终还是必须使用该网络的硬件地址。但IP地址和下面的网络的硬件地址之间由于格式不同而不存在简单的映射关系。此外，在一个网络上可能经常会有新的主机加入，或者撤走一些主机。更换网络适配器也会使主机的硬件地址改变。地址解析协议ARP解决这个问题的方法是在主机ARP高速缓存中存放一个从IP地址到硬件地址的映射表，并且这个映射表还经常动态更新。

  **每一台主机都设有一个ARP高速缓存（APR Cache），里面由本局域网上的各主机和路由器的IP地址到硬件地址的映射表，这些都是该主机目前知道的一些地址。**

  **当主机A要向本局域网上的某台主机B发送IP数据报时，就先在其ARP高速缓存中查看有无主机B的IP地址。如有，就在ARP高速缓存中查出其对应的硬件地址，再把这个硬件地址写入MAC帧，然后通过局域网把该MAC帧发往此硬件地址。**

**也有可能查不到主机B的IP地址的项目。这可能是主机B才入网，也可能是主机A刚刚加电，其高速缓存还是空的。在这种情况下，主机A就自动运行ARP, 然后按以下步骤找出主机B的硬件地址。**

**(1) ARP进程在本局域网H广播发送-一个ARP请求分组(具体格式可参阅[COME06]的第23章)。图4-11(a)是主机A广播发送ARP请求分组的示意图。ARP请求分组的主要内容是:“我的IP地址是209.0.0.5， 硬件地址是00-00-C0-15-AD-18。 我想知道IP地址为209.0.0.6的主机的硬件地址。”**

**(2)在本局域网上的所有主机上运行的ARP进程都收到此ARP请求分组。**

**(3) 主机B的IP地址与ARP请求分组中要查询的IP地址一致，就收下这个ARP请求分组，并向主机A发送ARP响应分组(其格式见[COME06])，同时在这个ARP响应分组中写入自己的硬件地址。由于其余的所有主机的IP地址都与ARP请求分组中要查询的IP地址不一致，因此都不理睬这个ARP请求分组，见图4-11(b)。ARP响应分组的主要内容是:“我勺IP地址是209.0.0.6， 我的硬件地址是08-00-2B-00-EE-0A。”请注意:虽然ARP请求分组广播发送的，但ARP响应分组是普通的单播，即从一个源地址发送到一一个目的地址。**

**(4)主机A收到主机B的ARP响应分组后，就在其ARP高速缓存中写入主机B的IP地址到硬件地址的映射。**

![image-20231115171100742](assets\image-20231115171100742.png)

IP数据包格式：

![image-20231115171122727](assets\image-20231115171122727.png)

在路由表中，对每一条路由最主要的是以下两个信息：

  (目的网络地址，下一条地址)



## 三 划分子网和构造超网



### 划分子网

​     划分子网之后的ip地址结构：

​     Ip地址：：=｛<网络号>，<子网号>，<主机号>｝



### 子网掩码

​     使用子网掩码的好处：不管网络有没有划分子网，只要把子网掩码和Ip地址进行按位与运算，就立即得出网络地址来。

- A类地址的默认子网掩码：255.0.0.0
- B类地址的默认子网掩码：255.255.0.0
- C类地址的默认子网掩码：255.255.255.0

​     划分子网增加了灵活性，但却减少了能够连在网络上的主机数。



### 无分类编址CIDR (构造超网)

- CIDR消除了传统的A类，B类，C类地址以及划分子网的概念
- CIDR使得IP地址从三级编址变回了二级编址，还使用斜线记法，即在IP地址后面加上斜线/，然后写上网络前缀所占的位数。
- CIDR使用的地址掩码也可以继续称之为子网掩码，例如/20地址块的地址掩码是11111111 11111111 11110000 00000000



### 网际控制报文协议ICMP

  为了更有效的转发IP数据报，提高交付成功的机会，在网际层使用了网际控制报文协议ICMP。

  ICMP报文的种类有两种

1. ICMP差错报告报文
2. ICMP询问报文



### 互联网的路由选择协议

  静态路由

- 特定路由
- 默认路由

  动态路由

- 域内路由
- 域间路由



### 互联网把路由选择协议划分为两大类

- 内部网关协议(IGP)

  RIP 距离矢量算法（定期和相邻的路由器交换自己的路由信息）

​     OSPF 最短路径算法

- 外部网关协议（EGP）

​     BGP



### 路由器的构成

路由器结构可划分为两大部分：路由选择部分和分组转发部分。



### 虚拟专用网VPN和网络地址转换

10.0.0.0到10.255.255.255

172.16.0.0到172.31.255.255

192.168.0.0到192.168.255.255

上述地址不能与互联网互通。



### 网络地址转换NAT

  作用：节省IP地址



# 第五章	运输层



## 一 运输层协议概述

- 进程之间的通信

​     1.运输层向它上面的应用层提供通信服务

​     2.端到端的通信是应用进程之间的通信

​     3.网络层为主机之间提供逻辑通信，而运输层为应用进程之间提供端到端的逻辑通信

​     4.**运输层以下的传输都是不可靠的**

- 运输层的两个主要协议

​     1.用户数据报协议**UDP**

​     2.传输控制协议**TCP**

​     两个对等运输实体在通信时传送的数据单位叫做运输协议数据单元。但在TCP/IP体系中，根据使用的协议分为**TCP报文段**或**UDP用户数据报**。

​     UDP在传送数据之前**不需要事先建立连接**

​     TCP则**提供面向连接的服务**

- 运输层端口

​     服务器使用的端口号：0～1023

​     登记端口号：1024～49151

​     客户端使用的端口号：49152～65535



## 二 用户数据报协议UDP

- UDP概述

​     UDP的主要特点

​     1.UDP是无连接的

​     2.UDP使用尽最大努力交付

​     3.UDP是面向报文的

​     4.UDP没有拥塞控制

​     5.UDP支持一对一，一对多，多对一和多对多的交互通信

​     6.UDP的首部开销小

- UDP的首部格式

​     UDP数据报有两个字段：数据字段和首部字段。

​     UDP首部字段格式（8字节）：

1. 源端口
2. 目的端口
3. 长度
4. 检验和



## 三 传输控制协议TCP概述

- TCP最主要的特点

1. TCP是面向连接的运输层协议
2. 每一条TCP连接只能有两个端点，每一条TCP连接只能是点对点的。
3. TCP提供可靠交付的服务
4. TCP提供全双工通信
5. 面向字节流

- TCP的连接

​     TCP把连接作为最基本的抽象

​     TCP连接的端点叫做套接字或插口

​     **套接字socket=(IP地址：端口号)**

​     **TCP连接::=｛socket1，socket2｝=｛（IP1：port1）,(IP2:port2)｝**



## 四 可靠传输的工作原理

- 停止等待协议
- 连续ARQ协议



## 五 TCP报文段的首部格式

   TCP首部的最小长度是20字节

![image-20231115171822026](assets\image-20231115171822026.png)

 确认号，即ACK，为1时有效，为0时无效



## 六 TCP可靠传输的实现

- 以字节为单位的滑动窗口
- 超时重传时间的选择
- 选择确认SACK



## 七 TCP的拥塞控制

   拥塞控制就是防止过多的数据注入到网络中，这样可以使网络中的路由器或链路不致过载。

![image-20231115171858206](assets\image-20231115171858206.png)



## 八 TCP的运输连接管理



### TCP的连接建立

  TCP建立连接的过程叫做握手，握手需要在客户和服务器之间交换三个TCP报文段。

![image-20231115171925989](assets\image-20231115171925989.png)

![image-20231115171944796](assets\image-20231115171944796.png)



### TCP的连接释放

![image-20231115172020331](assets\image-20231115172020331.png)



# 第六章	应用层



## 一 域名解析系统

  域名系统DNS是互联网使用的命名系统，用来把便于人们使用的**机器名字转换为IP地址**。

  域名到IP地址的解析是由分布在互联网上的许多**域名服务器程序**共同完成的。域名服务器程序在专设的结点上运行，而人们也常把运行域名服务器程序的机器称为域名服务器。

  域名到IP地址的解析过程的要点如下：当某一个应用进程需要把主机名解析为IP地址时，该应用进程就调用**解析程序**，并成为DNS的一个客户，把待解析的域名放在DNS请求报文中，以**UDP用户数据报方式**发给本地域名服务器（用UDP是为了减小开销）。

  文件传送协议：FTP

  超文本传输协议：HTTP （使用TCP连接）

  简单邮件传送协议：SMTP