ls usr测试环境

```shell
putty登录
192.168.13.161:22 login:sunell pwd:sunell2024.
odoo-shell: docker exec -it -u root sunell_scm_fix bash
odoo shell -c /etc/odoo/odoo.conf -d prod_scm

日志打印：/usr/odoo_shell
		./scm_log.sh
		
数据库用户：project_manage
	密码:sunell
```

新测试环境：
日更
192.168.13.161:5050
192.168.13.161:8000

周更
192.168.13.162:5000
192.168.13.162:7000



箱码测试码：

```
140-20-50-0078-01*100*311312006


140-05-00-0078-01*100*522308001
140-05-00-0077-01*10*522308001

110-10-20-0015-01*10*121312026

委外：
140-40-10-0296-01*50*311312006

290-200-0004-01*50*131903002


140-40-10-0441-01*50*311312006

self.env['line.side.in.order.line.detail'].create([{'order_id': 1, 'tag_code': '140-05-00-0077-01*100*522308001'}])


self.env['line.side.in.order.line.detail'].create([{'order_id': 1, 'tag_code': '140-05-00-0078-01*100*522308001'}])

self.env['line.side.in.order.line.detail'].create([{'order_id': 1, 'tag_code': '140-20-50-0078-01*100*311312006'}])
```



```
F:\Environment\python\python.exe pip install pycups
```





收货单打印代码临时存放

```
                            <button name="print_receiving_orders_pdf" type="object" string="打印单据"
                                    style="font-size: 15px;border-radius:15px;background-color: black;border-color: #adb5bd;color: white"/>
```



```
controller：

import json
@http.route('/print_batch_receiving_order', type='http', auth="user")
    def export_after_sale_data_excel(self, **kw):
        ids = kw.get('ids', False)
        method = kw.get('method', False)
        model = kw.get('model', False)
        orders = http.request.env['receiving.order'].sudo().search([('id', 'in', json.loads(ids))])
        file_name, byte_data = getattr(http.request.env[model], method)(orders)
        subtype_id = http.request.env.ref('mail.mt_note').id
        for order in orders:
            order.message_post(body='test', subtype_id=subtype_id)
        response = http.request.make_response(
            byte_data,
            headers=[
                ('Content-Type', 'application/pdf'),
                ('Content-Disposition', 'attachment; filename=batch_printed_orders.pdf')
            ]
        )
        return response
        

```

```
from PyPDF2 import PdfFileMerger
import tempfile
import os
import win32print
    def print_receiving_orders_pdf(self):
        if self._context.get('receiving_orders'):
            receiving_orders = self.env['receiving.order'].browse(self._context.get('receiving_orders'))
            pdf_content = self.get_receiving_orders_pdf(receiving_orders)
            temp_pdf = tempfile.NamedTemporaryFile(delete=False, suffix=".pdf")
            temp_pdf.write(pdf_content)
            temp_pdf.close()

            # 打印PDF
            printer_name = r"\\192.168.13.62\EPSON LQ-630K ESC/P 2 Ver 2.0"
            hprinter = win32print.OpenPrinter(printer_name)
            try:
                # 创建打印文档
                job_id = win32print.StartDocPrinter(hprinter, 1, ("Print Job", None, "RAW"))
                win32print.StartPagePrinter(hprinter)

                with open(temp_pdf.name, "rb") as f:
                    pdf_data = f.read()
                    win32print.WritePrinter(hprinter, pdf_data)

                win32print.EndPagePrinter(hprinter)
                win32print.EndDocPrinter(hprinter)
            finally:
                win32print.ClosePrinter(hprinter)
                os.remove(temp_pdf.name)

            # 删除临时文件


            # url = '/print_batch_receiving_order?model={}&ids={}&method={}'.format(self._name, self._context.get('receiving_orders'), 'get_receiving_orders_pdf')
            # return {
            #     'type': 'ir.actions.act_url',
            #     'url': url,
            #     'target': 'self',
            #     'tfs_close': True
            # }

    def get_receiving_orders_pdf(self, receiving_orders):
        pdf_merger = PdfFileMerger()
        for order in receiving_orders:
            pdf_content, _ = self.env.ref('order_processing.report_receiving_order_a4')._render_qweb_pdf([order.id])
            pdf_merger.append(io.BytesIO(pdf_content))
        merged_pdf_content = io.BytesIO()
        pdf_merger.write(merged_pdf_content)
        pdf_merger.close()
        return merged_pdf_content.getvalue()
```



```
bom反查测试用例
单独
110-01-00-0011-01
140-40-10-0742-01
110-01-00-0007-01


包含：
130-20-20-0021-01
150-21-20-0014-01
163-20-00-0072-01

相等：
100-00-20-0001-01
170-61-00-0004-01
170-61-00-0021-01
170-61-00-0022-01
170-61-00-0043-01
300-000-0152

越南相等：
620-40-320-00397
170-18-30-0018-01
170-60-00-0015-01
170-60-00-0012-02
170-13-00-0047-01
170-18-30-0301-02
170-46-30-0231-03
290-000-0008-02
```

```
7：26
8：27

        self.ensure_one()
        self.line_ids = [(5, 0, 0)]
        conn = psycopg2.connect(
                        dbname=self.db_info_id.name,
                        user=self.db_info_id.user,
                        password=self.db_info_id.pwd,
                        host=self.db_info_id.host,
                        port=self.db_info_id.port
                    )
        cr = conn.cursor()
        query1 = """
                    SELECT DISTINCT
                        pt.default_code,
                        pt.name,
                        pt.x_model_standard
                    FROM product_template as pt 
        """
        self.env.cr.execute(query1)
        self_products = self.env.cr.fetchall()
        cr.execute(query1)
        remote_products = cr.fetchall()
        target_products = list(set(self_products) ^ set(remote_products))
        print(target_products)
        domain = []
        if domain:
            for pd in target_products:
                domain.append(pd[0])
            query2 = """
                        SELECT DISTINCT
                            pt.id,
                            pt.default_code,
                            pt.name,
                            pt.x_model_standard
                        FROM product_template as pt 
                        WHERE pt.default_code in ({})
                    """
            search = ''
            search += "'" + "','".join(domain) + "'"
            cr.execute(query2.format(search))
            res_products = cr.fetchall()
```







